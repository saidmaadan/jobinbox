<div class='company-imgbg'>
  <%= image_tag @company.avatar_url if @company.avatar_url %>
</div>
<div class='container'>
  <div class='row company-content'>
    <div class='col-sm-3'>
      <div class='row'>
        <div class='col-xs-12 company_logo'>
          <%= image_tag @company.logo_url if @company.avatar_url %>
        </div><br>
        <div class='col-xs-12'>
          <div class='company-tab'>

          <ul class="nav nav-tabs nav-stacked" role="tablist">
              <li role="presentation" class="active"><a href="#about" aria-controls="about" role="tab" data-toggle="tab">About <%= @company.name %></a></li>
              <li role="presentation"><a href="#job" aria-controls="job" role="tab" data-toggle="tab"><%= @company.name %> Jobs</a></li>
              <li role="presentation"><a href="#reviews" aria-controls="reviews" role="tab" data-toggle="tab">Reviews</a></li>
              <li role="presentation"><a href="#salary" aria-controls="salary" role="tab" data-toggle="tab">Salary</a></li>
              <% if current_employer || current_candidate %>
                <li role="presentation"><a href="#write-review" aria-controls="WriteReview" role="tab" data-toggle="tab"><div class='write-review'>Write a Review</div></a></li>
              <% else %>
                <li role="presentation"><div><%= link_to 'Signin to Write a Review', signin_path, class: "btn btn-success btn-group-justified" %></div></li>
              <% end %>
            </ul>
          </div>
        </div>
        <div>
          
        </div>
      </div>  
    </div>
    <div class='col-sm-6 company-content-tab'>
      <div class="tab-content">

    <div role="tabpanel" class="tab-pane active" id="about"><p><%= @company.about %></p></div>
    <div role="tabpanel" class="tab-pane" id="job">
      <% Job.all.order('created_at DESC').limit(10).each do |job| %>
        <% if job.company_name == @company.name %>
          <div class='row'>
            <div class='col-sm-12'>
              <h2><%= link_to job.title, job %></h2>
               <p><%= truncate job.description, length: 200, separator: ' ' %></p>
               <%= link_to "View full job description", job %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <div role="tabpanel" class="tab-pane" id="reviews">
      <div class="star-rating" data-score=<%= @avg_rating %> ></div>
        <p><%= "#{@reviews.length} reviews" %></p>
        <% if @reviews.blank? %>
          <h3>No reviews yet. Be the first to post your review <%= @company.name %></h3>
        <% else %>
        
        <h3><%= @company.name %> Reviews</h3><hr>
          <% @reviews.each do |r| %>
            <div class="row">

                <div class='col-sm-5'>
                <div class='row'>
                  <div class='col-xs-5'>
                  <%# if r.user.image_url %>
                    <%#= image_tag r.user.image_url, class: 'img-responsive', style: 'width:100%;height:100px;border-radius:50%;' %>
                    <%# else %>
                    <!-- <i class="fa fa-user fa-4x" ></i> -->
                    
                    <%# end %>
                  </div>
                  <div class='col-xs-7'>
                    <!-- <h5>By: <%#= link_to ("#{r.user.first_name.capitalize} #{r.user.last_name.capitalize[0]}."), r.user %></h5> -->
                      <%= r.created_at.strftime("%-m/%-d/%y") %><br>
                      <div class='star-rating' data-score= <%= r.rating %> ></div>
                </div>
                  </div>
                </div>
                
                    
                    <div class='col-sm-7'>
                        <p><%= h(r.pros).gsub(/\n/, '<br/>').html_safe %></p>
                <% if current_employer %>
                <%# if (r.user == current_user) || (current_user.admin?)%>
                <%= link_to "Edit", edit_company_review_path(@company, r) %> | 
                <%= link_to "Delete", company_review_path(@company, r), method: :delete, data: { confirm: 'Are you sure?' }%>
                
                <% end %><br>
               
                    </div>

                  </div> 

                  <hr>
            <% end %>
          <% end %>
        </div>
        <div role="tabpanel" class="tab-pane" id="salary"></div>
        <div role="tabpanel" class="tab-pane" id="write-review"><p><%= render partial: 'reviews/form' %></div>
      </div>   
    </div>
    <div class='col-sm-3 hidden-xs'> 
      <% if @reviews.blank? %>
      <% else %>
        <h3><%= @company.name %> Reviews</h3><hr>
          <div class="star-rating" data-score= <%= @avg_rating %> ></div>
            <p><%= "#{@reviews.length} reviews" %></p>
      <% end %>
    </div>
  </div>
</div>

<script>
  $('.star-rating').raty({
    path: 'https://s3.amazonaws.com/foodplace/uploads/stars',
    readOnly: true,
    score: function(){
      return $(this).attr('data-score');
    }
  });
  $('.write-review').on('click', function(){
    $('.review-form').toggle("slow");
    });
    
</script>


